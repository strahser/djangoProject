{% extends "admin/change_list.html" %}
{% block breadcrumbs %}
{{ block.super }}
    <form action="{% url 'handle_incoming_email' %}" method="post">
     {% csrf_token %}
    <label for="mail_count">Кол-во писем: </label>
    <input id="mail_count" type="number" min="1" step="1"  name="mail_count" value="10">
    <input class="btn btn-info pull-right" type="submit" value="Получить ПОЧТУ">
</form>
{% endblock %}
{% block result_list %}
   <div class="card">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="table-tab" data-bs-toggle="tab" data-bs-target="#table"
                            type="button" role="tab" aria-controls="table" aria-selected="true">Задачи
                    </button>
                </li>
                {% for pivot_table in pivot_table_list %}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pivot-tab-{{ forloop.counter }}" data-bs-toggle="tab"
                                data-bs-target="#pivot-{{ forloop.counter }}" type="button" role="tab"
                                aria-controls="pivot-{{ forloop.counter }}"
                                aria-selected="false">{{ pivot_table.name }}
                        </button>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="table" role="tabpanel" aria-labelledby="table-tab">
                    {{ block.super }}
                </div>
                {% for pivot_table in pivot_table_list %}
                    <div class="tab-pane fade" id="pivot-{{ forloop.counter }}" role="tabpanel"
                         aria-labelledby="pivot-tab-{{ forloop.counter }}">
                        {{ pivot_table.table | safe }}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('#myTab button[data-bs-toggle="tab"]');

            tabButtons.forEach(function (tabButton) {
                tabButton.addEventListener('click', function (event) {
                    event.preventDefault();
                    const tabTarget = this.getAttribute('data-bs-target');
                    const tabContent = document.querySelector(tabTarget);

                     if (tabContent) {
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active');
                            const btnTarget = btn.getAttribute('data-bs-target');
                            const btnContent = document.querySelector(btnTarget);
                             if (btnContent) {
                              btnContent.classList.remove('show', 'active')
                             }
                            });
                             this.classList.add('active')
                          tabContent.classList.add('show', 'active')

                     }

                });
            });
        });
    </script>
{% endblock %}